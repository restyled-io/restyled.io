---
name: restyled
version: "0.0.0"

# Dependencies shared in *all* targets
dependencies:
  - base

default-extensions:
  # TODO: move away from ClassyPrelude
  - NoImplicitPrelude

ghc-options: -Wall

library:
  dependencies:
    - aeson
    - blaze-markup
    - bytestring
    - case-insensitive
    - classy-prelude
    - classy-prelude-yesod
    - conduit
    - containers
    - envparse
    - fast-logger
    - file-embed
    - formatting
    - github
    - gitrev
    - hedis
    - hjsmin
    - http-client
    - http-client-tls
    - http-conduit
    - http-types
    - jwt
    - load-env
    - monad-logger
    - persistent
    - persistent-postgresql
    - persistent-template
    - process
    - safe-exceptions
    - shakespeare
    - template-haskell
    - text
    - time
    - unix
    - unordered-containers
    - vector
    - wai
    - wai-extra
    - wai-logger
    - warp
    - yesod
    - yesod-auth
    - yesod-auth-oauth2
    - yesod-core
    - yesod-form
    - yesod-static
  source-dirs: src
  when:
    - condition: flag(dev)
      then:
        ghc-options:
          - -O0
        cpp-options: -DDEVELOPMENT
      else:
        ghc-options:
          - -O2

executables:
  restyled.io:
    main: main.hs
    source-dirs: app
    ghc-options:
      - -threaded
      - -rtsopts
      - -with-rtsopts=-N
    dependencies:
      - restyled

  restyled.io-backend:
    main: main.hs
    source-dirs: backend
    ghc-options:
      - -threaded
      - -rtsopts
      - -with-rtsopts=-N
    dependencies:
      - restyled

tests:
  test:
    main: Spec.hs
    source-dirs: test
    dependencies:
      - restyled
      - bytestring
      - classy-prelude
      - hedis
      - hspec
      - hspec-expectations-lifted
      - load-env
      - monad-logger
      - persistent
      - shakespeare
      - text
      - yesod-core
      - yesod-test

flags:
  library-only:
    description: Unused, but yesod-devel passes it.
    manual: false
    default: false
  dev:
    description: Turn on development settings, like auto-reload templates.
    manual: false
    default: false
